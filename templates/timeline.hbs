<article>
    <h1>{{post.title}}</h1>
    {{#if post.metadata.description}}
    <p class="post-subtitle">
        {{post.metadata.description}}
    </p>
    {{/if}}
    <time datetime="{{post.date}}">{{formatDate post.date "MMMM d, yyyy"}}</time>

    {{#if post.content}}
    <div class="content">
        {{{post.content}}}
    </div>
    {{/if}}
</article>

<style>
.timeline-layout {
    display: grid;
    grid-template-columns: 1fr 200px;
    gap: var(--spacing-xl);
    position: relative;
    max-width: calc(var(--content-width) + 200px + var(--spacing-xl));
    margin: 0 auto;
}

.timeline-content {
    max-width: var(--content-width);
    min-height: 400px;
    position: relative;
}

.timeline-nav {
    position: fixed;
    right: var(--spacing-large);
    top: 50%;
    transform: translateY(-50%);
    display: flex;
    flex-direction: column;
    gap: var(--spacing-base);
    z-index: 100;
}

.timeline-nav::before {
    content: '';
    position: absolute;
    left: 8px;
    top: 0;
    bottom: 0;
    width: 2px;
    background: var(--fg-muted);
    opacity: 0.3;
}

.timeline-milestone {
    position: relative;
    padding-left: 24px;
    color: var(--fg-muted);
    text-decoration: none;
    font-size: 0.875rem;
    font-family: var(--font-sans);
    transition: color 0.2s;
    line-height: 1.4;
}

.timeline-milestone::before {
    content: '';
    position: absolute;
    left: 0;
    top: 0.4em;
    width: 8px;
    height: 8px;
    border-radius: 50%;
    background: var(--fg-muted);
    opacity: 0.5;
    transition: all 0.2s;
}

.timeline-milestone:hover {
    color: var(--fg);
}

.timeline-milestone:hover::before {
    opacity: 1;
    background: var(--accent);
    transform: scale(1.2);
}

.timeline-milestone.active {
    color: var(--fg);
    font-weight: 500;
}

.timeline-milestone.active::before {
    opacity: 1;
    background: var(--accent);
    transform: scale(1.3);
}

.timeline-section {
    display: none;
    animation: fadeIn 0.3s ease-in;
}

.timeline-section.active {
    display: block;
}

.timeline-section figure {
    margin: var(--spacing-large) 0;
}

.timeline-section figure img {
    width: 100%;
    height: auto;
    display: block;
}

.timeline-section figcaption {
    margin-top: var(--spacing-base);
}

.timeline-section figcaption .caption-title {
    font-weight: 500;
    font-size: 1rem;
    color: var(--fg);
    margin-bottom: 0.5em;
    display: block;
}

.timeline-section figcaption .caption-text {
    color: var(--fg-muted);
    font-size: 0.9375rem;
    line-height: 1.6;
}

.timeline-next-button {
    margin-top: var(--spacing-large);
    padding: 0.75em 1.5em;
    background: var(--bg-subtle);
    color: var(--fg);
    border: 1px solid var(--fg-muted);
    border-radius: 4px;
    font-family: var(--font-sans);
    font-size: 0.9375rem;
    cursor: pointer;
    transition: all 0.2s;
    text-decoration: none;
    display: inline-block;
}

.timeline-next-button:hover {
    background: var(--accent);
    color: var(--bg);
    border-color: var(--accent);
}

.timeline-next-button:active {
    transform: translateY(1px);
}

@keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
}

@media (max-width: 900px) {
    .timeline-layout { grid-template-columns: 1fr; }
    .timeline-nav {
        position: static;
        transform: none;
        flex-direction: row;
        flex-wrap: wrap;
        margin-bottom: var(--spacing-large);
        padding-left: 0;
    }
    .timeline-nav::before { display: none; }
    .timeline-milestone {
        padding-left: 0;
        padding: 0.5em 1em;
        background: var(--bg-subtle);
        border-radius: 4px;
    }
    .timeline-milestone::before { display: none; }
}
</style>

<noscript>
    <style>
        .timeline-section {
            display: block !important;
            margin-bottom: var(--spacing-xl);
        }
    </style>
</noscript>

<div class="timeline-layout">
    <div class="timeline-content">
        {{#each post.metadata.timeline}}
        <section id="{{id}}" class="timeline-section">
            <figure>
                {{#if img}}
                <img src="{{img}}" alt="{{#if alt}}{{alt}}{{else}}{{captionTitle}}{{/if}}">
                {{/if}}
                <figcaption>
                    <span class="caption-title">{{captionTitle}}</span>
                    <span class="caption-text">{{{md captionText}}}</span>
                </figcaption>
            </figure>
            {{#unless @last}}
            <button class="timeline-next-button">Next â†’</button>
            {{/unless}}
        </section>
        {{/each}}
    </div>

    <nav class="timeline-nav">
        {{#each post.metadata.timeline}}
        <a href="#{{id}}" class="timeline-milestone">{{id}}</a>
        {{/each}}
    </nav>
</div>


<script>
(function() {
    'use strict';

    const sections = Array.from(document.querySelectorAll('.timeline-section'));
    const milestones = Array.from(document.querySelectorAll('.timeline-milestone'));

    if (sections.length === 0 || milestones.length === 0) return;

    const sectionIds = sections.map(s => s.id);

    function removeActive() {
        milestones.forEach(m => m.classList.remove('active'));
        sections.forEach(s => s.classList.remove('active'));
    }

    function showSection(sectionId, updateHistory) {
        removeActive();
        const section = document.getElementById(sectionId);
        const milestone = document.querySelector('.timeline-milestone[href="#' + sectionId + '"]');

        if (section) section.classList.add('active');
        if (milestone) milestone.classList.add('active');

        if (updateHistory !== false) {
            history.pushState({ sectionId: sectionId }, '', '#' + sectionId);
        }
    }

    // Init
    const hashId = window.location.hash ? window.location.hash.substring(1) : null;
    if (hashId && sectionIds.includes(hashId)) {
        showSection(hashId, false);
    } else {
        showSection(sectionIds[0], false);
    }

    milestones.forEach(milestone => {
        milestone.addEventListener('click', function(e) {
            e.preventDefault();
            const targetId = this.getAttribute('href').substring(1);
            showSection(targetId);
        });
    });

    const nextButtons = Array.from(document.querySelectorAll('.timeline-next-button'));
    nextButtons.forEach(button => {
        button.addEventListener('click', function(e) {
            e.preventDefault();
            const current = this.closest('.timeline-section');
            if (!current) return;
            const idx = sectionIds.indexOf(current.id);
            if (idx < 0) return;
            const nextId = sectionIds[idx + 1];
            if (nextId) showSection(nextId);
        });
    });

    window.addEventListener('popstate', function(e) {
        if (e.state && e.state.sectionId) {
            showSection(e.state.sectionId, false);
        }
    });
})();
</script>


